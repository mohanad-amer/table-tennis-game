<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <title>M.A. Table Tennis üèì</title>
    <meta name="description" content="A professional table tennis experience by M.A.">

    <style>
        /* Luxury Serif Font for Signature */
        @import url('https://fonts.googleapis.com/css2?family=Bodoni+Moda:wght@600&display=swap');

        * { margin: 0; padding: 0; box-sizing: border-box; touch-action: none; }
        
        body {
            font-family: -apple-system, system-ui, sans-serif;
            background: #0f0f1a;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            color: white;
            overflow: hidden;
            padding: 10px 15px;
        }

        /* Top Menu Bar */
        .controls { 
            background: rgba(255, 255, 255, 0.08); 
            padding: 6px 10px; border-radius: 12px; 
            display: flex; gap: 6px; margin-bottom: 8px;
            width: 100%; max-width: 400px; justify-content: center; flex-shrink: 0;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        select, input, button { 
            padding: 5px; border-radius: 6px; border: none; 
            background: #2a2a40; color: white; font-size: 11px; font-weight: 600;
        }
        input[type="number"] { width: 35px; text-align: center; }
        button#startBtn { background: #4CAF50; cursor: pointer; }
        button#resetBtn { background: #f44336; cursor: pointer; }

        .scores { 
            display: flex; justify-content: space-around;
            width: 100%; max-width: 350px; font-weight: 800;
            font-size: 15px; margin-bottom: 8px; flex-shrink: 0;
        }

        /* The Professional Court */
        #gameCanvas {
            border: 2px solid #fff; border-radius: 8px;
            background: #2d8659; width: 100%; max-width: 380px;
            flex-grow: 1; max-height: 58vh; 
            box-shadow: 0 10px 25px rgba(0,0,0,0.5); display: block;
        }

        /* Control Area */
        .control-footer {
            width: 100%; max-width: 380px; display: flex;
            justify-content: center; gap: 15px;
            padding: 15px 0 env(safe-area-inset-bottom); flex-shrink: 0;
        }

        .btn-touch {
            flex: 1; height: 55px; max-width: 140px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 30px; display: flex;
            align-items: center; justify-content: center; font-size: 24px;
        }

        .btn-touch:active { background: rgba(76, 175, 80, 0.4); transform: scale(0.96); }

        #p2TouchZone { display: none; margin-bottom: 10px; }

        .game-over {
            position: fixed; top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.95); padding: 30px;
            border-radius: 20px; text-align: center;
            display: none; z-index: 100; border: 2px solid #4CAF50;
        }
    </style>
</head>
<body>

    <div class="controls">
        <select id="gameMode">
            <option value="single">vs Robot</option>
            <option value="two-player">2 Players</option>
        </select>
        <select id="difficulty">
            <option value="easy">Easy</option>
            <option value="medium" selected>Medium</option>
            <option value="hard">Hard</option>
        </select>
        <div style="display:flex; align-items:center; gap:3px;">
            <span style="font-size:10px;">Pts:</span>
            <input type="number" id="winPoints" value="11">
        </div>
        <button id="startBtn">START</button>
        <button id="resetBtn">RESET</button>
    </div>

    <div class="control-footer" id="p2TouchZone">
        <div class="btn-touch" id="p2Left">‚óÄ</div>
        <div class="btn-touch" id="p2Right">‚ñ∂</div>
    </div>

    <div class="scores">
        <div id="labelTop" style="color: #ffadad;">Robot: <span id="scoreTop">0</span></div>
        <div style="color: #9bf6ff;">YOU: <span id="scoreBottom">0</span></div>
    </div>

    <canvas id="gameCanvas" width="450" height="750"></canvas>

    <div class="control-footer">
        <div class="btn-touch" id="p1Left">‚óÄ</div>
        <div class="btn-touch" id="p1Right">‚ñ∂</div>
    </div>

    <div class="game-over" id="gameOver">
        <h2 id="winnerText">WINNER!</h2>
        <button onclick="location.reload()" style="margin-top:15px; padding:10px 20px; background:#4CAF50; color:white; border:none; border-radius:10px; font-weight:bold;">PLAY AGAIN</button>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        function playSfx(freq, dur, vol) {
            try {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.connect(gain); gain.connect(audioCtx.destination);
                osc.frequency.value = freq; gain.gain.value = vol;
                osc.start(); gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + dur);
                osc.stop(audioCtx.currentTime + dur);
            } catch(e) {}
        }

        let gameRunning = false, pBX = 175, pTX = 175, sB = 0, sT = 0;
        let bX = 225, bY = 375, bSX = 6, bSY = 6; 
        const pThick = 18, pLen = 100, bRad = 10, pSpd = 12; 
        const keys = {}, touch = { p1L: false, p1R: false, p2L: false, p2R: false };

        window.addEventListener('keydown', e => keys[e.key] = true);
        window.addEventListener('keyup', e => keys[e.key] = false);

        function bindT(id, prop) {
            const el = document.getElementById(id);
            const set = (val) => (e) => { e.preventDefault(); touch[prop] = val; };
            el.addEventListener('touchstart', set(true)); el.addEventListener('touchend', set(false));
            el.addEventListener('mousedown', () => touch[prop] = true); el.addEventListener('mouseup', () => touch[prop] = false);
        }
        bindT('p1Left', 'p1L'); bindT('p1Right', 'p1R');
        bindT('p2Left', 'p2L'); bindT('p2Right', 'p2R');

        document.getElementById('gameMode').onchange = (e) => {
            const is2P = e.target.value === 'two-player';
            document.getElementById('p2TouchZone').style.display = is2P ? 'flex' : 'none';
            document.getElementById('labelTop').innerHTML = (is2P ? 'P2: ' : 'Robot: ') + `<span id="scoreTop">${sT}</span>`;
        };

        function resetBall() {
            bX = 225; bY = 375;
            bSY = Math.random() < 0.5 ? 6 : -6;
            bSX = (Math.random() - 0.5) * 8;
        }

        function update() {
            if (!gameRunning) return;
            if ((keys['ArrowLeft'] || touch.p1L) && pBX > 0) pBX -= pSpd;
            if ((keys['ArrowRight'] || touch.p1R) && pBX < canvas.width - pLen) pBX += pSpd;
            if (document.getElementById('gameMode').value === 'two-player') {
                if ((keys['a'] || touch.p2L) && pTX > 0) pTX -= pSpd;
                if ((keys['d'] || touch.p2R) && pTX < canvas.width - pLen) pTX += pSpd;
            } else {
                let aiSpd = (document.getElementById('difficulty').value === 'easy' ? 4.5 : 8);
                if (bSY < 0) {
                    if (pTX + pLen/2 < bX - 10) pTX += aiSpd;
                    else if (pTX + pLen/2 > bX + 10) pTX -= aiSpd;
                }
            }
            bX += bSX; bY += bSY;
            if (bX - bRad < 0 || bX + bRad > canvas.width) { bSX *= -1; playSfx(150, 0.05, 0.05); }
            if (bY + bRad > canvas.height - 30 && bX > pBX && bX < pBX + pLen && bSY > 0) {
                bSY = -Math.abs(bSY) * 1.05; bSX += (bX - (pBX + pLen/2)) / 8; playSfx(300, 0.1, 0.1);
            }
            if (bY - bRad < 30 && bX > pTX && bX < pTX + pLen && bSY < 0) {
                bSY = Math.abs(bSY) * 1.05; bSX += (bX - (pTX + pLen/2)) / 8; playSfx(300, 0.1, 0.1);
            }
            if (bY < 0) { sB++; resetBall(); playSfx(440, 0.2, 0.1); }
            if (bY > canvas.height) { sT++; resetBall(); playSfx(440, 0.2, 0.1); }
            document.getElementById('scoreBottom').textContent = sB;
            document.getElementById('scoreTop').textContent = sT;

            const win = parseInt(document.getElementById('winPoints').value) || 11;
            if (sB >= win || sT >= win) {
                gameRunning = false;
                document.getElementById('gameOver').style.display = 'block';
                document.getElementById('winnerText').textContent = sB >= win ? "YOU WIN!" : "ROBOT WINS!";
            }
        }

        function draw() {
            // Background
            ctx.fillStyle = '#2d8659'; ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Court Lines
            ctx.strokeStyle = 'rgba(255,255,255,0.3)'; ctx.lineWidth = 2;
            ctx.beginPath(); ctx.moveTo(0, 375); ctx.lineTo(450, 375); ctx.stroke();
            
            // The M.A. Signature
            ctx.save();
            ctx.fillStyle = '#1b5236'; // Darker forest green for elegance
            ctx.font = '600 18px "Bodoni Moda", serif'; 
            ctx.textAlign = 'right';
            ctx.fillText('M.A.', canvas.width - 20, canvas.height - 20);
            ctx.restore();
            
            // Paddles and Ball
            ctx.fillStyle = '#d2b48c'; 
            ctx.fillRect(pBX, canvas.height - 30, pLen, pThick); 
            ctx.fillRect(pTX, 15, pLen, pThick);
            ctx.fillStyle = '#fff'; ctx.beginPath(); ctx.arc(bX, bY, bRad, 0, Math.PI*2); ctx.fill();
        }

        function loop() { update(); draw(); requestAnimationFrame(loop); }
        document.getElementById('startBtn').onclick = () => { 
            if (audioCtx.state === 'suspended') audioCtx.resume();
            gameRunning = true; sB = 0; sT = 0; resetBall(); 
        };
        document.getElementById('resetBtn').onclick = () => location.reload();
        loop();
    </script>
</body>
</html>